<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gram Panchayat - Home</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- header / nav -->
    <header class="site-header">
        <div class="container">
            <a class="brand" href="index.html">Gram Panchayat</a>
            <button id="navToggle" class="nav-toggle">‚ò∞</button>
            <nav id="mainNav" class="nav">
                <a href="index.html" class="active">Home</a>
                <a href="about.html">About</a>
                <a href="members.html">Members</a>
                <a href="gallery.html">Gallery</a>
                <a href="schemes.html">Schemes</a>
                <a href="contact.html">Contact</a>
                <a href="dashboard.html" class="cta">Dashboard</a>
            </nav>
        </div>
    </header>

    <!-- hero -->
    <main>
        <section class="hero container">
            <h1>‚≠ê ‚Äú‡§à-‡§ó‡•ç‡§∞‡§æ‡§Æ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§π‡§∞‡§≥ ‡§Ø‡•á‡§•‡•á ‡§Ü‡§™‡§≤‡•á ‡§∏‡§π‡§∞‡•ç‡§∑ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á.‚Äù</h1>
            <p>‚Äú‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡§ï‡§§‡§æ ‡§Ü‡§£‡§ø ‡§®‡§ø‡§∑‡•ç‡§†‡•á‡§®‡•á ‡§ú‡§®‡§∏‡•á‡§µ‡•á‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§µ‡§ö‡§®‡§¨‡§¶‡•ç‡§ß ‡§Ü‡§π‡•ã‡§§.‚Äù</p>
        </section>

        <!-- map -->
        <section class="map container">
            <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3153.0865028744317!2d77.2090213153166!3d28.613939482382582!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x390cfd5b1b00b7a1%3A0x0!2zMjjCsDM2JzEyLjAiTiA3N8KwMTInMDkuOCJF!5e0!3m2!1sen!2sin!4v1600000000000!5m2!1sen!2sin"
                width="100%" height="420" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </section>

        <!-- dynamic info uploaded by admin -->
        <section class="info-list container">
            <h2>Notices & Info</h2>

            <!-- üîç SEARCH BAR -->
            <input type="text" id="noticeSearch" class="search-box" placeholder="Search notices...">

            <!-- ‚ñº SCROLL BOX ‚ñº -->
            <div class="info-scroll-box">
                <div id="infoItems" class="cards">
                    <!-- Dynamic info will appear here -->
                </div>
            </div>
        </section>

    </main>

    <footer class="site-footer">
        <div class="container">
            <small>¬© ‡§π‡§∞‡§≥ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‚Ä¢ ‡§∏‡§Æ‡§∞‡•ç‡§™‡§ø‡§§ ‡§∏‡•á‡§µ‡•á‡§∏‡§π ‡§®‡§ø‡§∞‡•ç‡§Æ‡§ø‡§§ ‚ù§Ô∏è</small>
        </div>
    </footer>

    <!-- Socket.io -->
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const infoContainer = document.getElementById('infoItems');
    const searchInput = document.getElementById('noticeSearch');

    let allNotices = [];

    function renderInfo(items) {
        infoContainer.innerHTML = '';
        if (!Array.isArray(items)) return;

        items.forEach(item => {

            // ‚≠ê CORRECT TYPE FIX
            const noticeType = item.type || "General";

            let tagClass = "tag-general";
            if (noticeType === "Important") tagClass = "tag-important";
            if (noticeType === "Urgent") tagClass = "tag-urgent";

            const card = document.createElement('div');
            card.className = 'card info-card';
            card.innerHTML = `
                <span class="notice-tag ${tagClass}">
                    ${noticeType}
                </span>
                <h3>${item.title}</h3>
                
                <!-- FIXED DESCRIPTION -->
                <p>${item.description || item.desc || ""}</p>
            `;
            infoContainer.appendChild(card);
        });
    }

    fetch('/api/info')
        .then(res => res.json())
        .then(data => {
            data.info.sort((a, b) => b.id - a.id);
            allNotices = data.info;
            renderInfo(allNotices);
        })
        .catch(err => console.error(err));

    socket.on('new-data', () => {
        fetch('/api/info')
            .then(res => res.json())
            .then(data => {
                data.info.sort((a, b) => b.id - a.id);
                allNotices = data.info;
                renderInfo(allNotices);
            })
            .catch(err => console.error(err));
    });

    // ‚≠ê FIXED SEARCH ‚Äî no error, works for all types
    searchInput.addEventListener("keyup", () => {
        const q = searchInput.value.toLowerCase();

        const filtered = allNotices.filter(n =>
            n.title.toLowerCase().includes(q) ||
            (n.description || n.desc || "").toLowerCase().includes(q) ||
            (n.type || "General").toLowerCase().includes(q)
        );

        renderInfo(filtered);
    });
</script>
